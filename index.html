<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Diff Viewer</title>
    
    <!-- Prism.js CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-vsc-dark-plus.min.css" rel="stylesheet" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #2d2d2d;
            color: #e0e0e0;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
        }

        .header {
            height: 60px;
            background-color: #2d2d2d;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .convert-btn {
            padding: 10px 30px;
            background-color: #10b981;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
        }

        .convert-btn:hover {
            background-color: #059669;
        }

        .container {
            display: flex;
            height: calc(100vh - 60px);
        }

        .left-panel, .right-panel {
            width: 50%;
            background-color: #2d2d2d;
            padding: 20px;
        }

        .left-panel {
            border-right: 1px solid #555555;
        }

        .code-textarea {
            width: 100%;
            height: 100%;
            background-color: #1e1e1e;
            color: #e0e0e0;
            border: 1px solid #3a3a3a;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', Consolas, monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: none;
            outline: none;
            white-space: pre;
            overflow-wrap: normal;
            overflow-x: auto;
        }

        .code-textarea:focus {
            border-color: #555555;
        }

        .code-display {
            width: 100%;
            height: 100%;
            background-color: #1e1e1e;
            border: 1px solid #3a3a3a;
            border-radius: 4px;
            font-family: 'Courier New', Consolas, monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre;
            overflow: auto;
            display: none;
            position: relative;
        }

        .line-numbers-container {
            position: sticky;
            left: 0;
            background-color: #1e1e1e;
            border-right: 1px solid #3a3a3a;
            z-index: 1;
            float: left;
            padding: 15px 0;
        }

        .line-number {
            color: #6e6e6e;
            padding: 2px 10px;
            min-width: 40px;
            text-align: right;
            user-select: none;
            display: block;
            line-height: 1.5;
        }

        .code-content {
            overflow-x: auto;
            padding: 15px;
            padding-left: 60px;
        }

        .code-line {
            min-height: 1.5em;
            line-height: 1.5;
        }

        .deleted-line {
            background-color: rgba(220, 38, 38, 0.2) !important;
            padding: 2px 5px;
            margin: 0 -5px;
        }

        .added-line {
            background-color: rgba(34, 197, 94, 0.2) !important;
            padding: 2px 5px;
            margin: 0 -5px;
        }
        
        /* Prism.js overrides for diff view */
        pre[class*="language-"] {
            background: transparent;
            margin: 0;
            padding: 0;
        }
        
        code[class*="language-"] {
            background: transparent;
        }
        
        /* VS Code-like syntax colors */
        .token.tag .tag-name { color: #569cd6; }
        .token.tag .punctuation { color: #808080; }
        .token.attr-name { color: #9cdcfe; }
        .token.string { color: #ce9178; }
        .token.comment { color: #6a9955; }
        .token.keyword { color: #c586c0; }
        .token.property { color: #9cdcfe; }
        .token.selector { color: #d7ba7d; }
        .token.value { color: #ce9178; }
        .token.color { color: #ce9178; }
        .token.punctuation { color: #808080; }
        .token.operator { color: #d4d4d4; }
        .token.function { color: #dcdcaa; }
        .token.number { color: #b5cea8; }
        .token.doctype { color: #808080; }
    </style>
</head>
<body>
    <div class="header">
        <button class="convert-btn">변환</button>
    </div>
    <div class="container">
        <div class="left-panel">
            <textarea class="code-textarea" id="leftCode" placeholder="기존 코드를 여기에 붙여넣으세요..." spellcheck="false"></textarea>
            <div class="code-display" id="leftDisplay"></div>
        </div>
        <div class="right-panel">
            <textarea class="code-textarea" id="rightCode" placeholder="수정된 코드를 여기에 붙여넣으세요..." spellcheck="false"></textarea>
            <div class="code-display" id="rightDisplay"></div>
        </div>
    </div>

    <!-- Prism.js JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <!-- Language support -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-jsx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-tsx.min.js"></script>

    <script>
        document.querySelector('.convert-btn').addEventListener('click', function() {
            const leftCode = document.getElementById('leftCode').value;
            const rightCode = document.getElementById('rightCode').value;
            
            const leftLines = leftCode.split('\n');
            const rightLines = rightCode.split('\n');
            
            const leftDisplay = document.getElementById('leftDisplay');
            const rightDisplay = document.getElementById('rightDisplay');
            
            // Clear previous results
            leftDisplay.innerHTML = '';
            rightDisplay.innerHTML = '';
            
            // Detect language (simple detection based on content)
            let language = detectLanguage(leftCode + '\n' + rightCode);
            
            // Create line number containers
            const leftLineNumbers = document.createElement('div');
            leftLineNumbers.className = 'line-numbers-container';
            const leftContent = document.createElement('div');
            leftContent.className = 'code-content';
            
            const rightLineNumbers = document.createElement('div');
            rightLineNumbers.className = 'line-numbers-container';
            const rightContent = document.createElement('div');
            rightContent.className = 'code-content';
            
            const maxLines = Math.max(leftLines.length, rightLines.length);
            
            for (let i = 0; i < maxLines; i++) {
                const leftLine = leftLines[i] !== undefined ? leftLines[i] : null;
                const rightLine = rightLines[i] !== undefined ? rightLines[i] : null;
                
                // Add line numbers
                const leftNum = document.createElement('div');
                leftNum.className = 'line-number';
                leftNum.textContent = i + 1;
                leftLineNumbers.appendChild(leftNum);
                
                const rightNum = document.createElement('div');
                rightNum.className = 'line-number';
                rightNum.textContent = i + 1;
                rightLineNumbers.appendChild(rightNum);
                
                // Left panel content
                const leftDiv = document.createElement('div');
                leftDiv.className = 'code-line';
                if (leftLine !== null) {
                    const highlightedLeft = highlightSyntax(leftLine || '\u00A0', language);
                    leftDiv.innerHTML = highlightedLeft;
                    if (rightLine === null || leftLine !== rightLine) {
                        leftDiv.classList.add('deleted-line');
                    }
                } else {
                    leftDiv.innerHTML = '\u00A0';
                }
                leftContent.appendChild(leftDiv);
                
                // Right panel content
                const rightDiv = document.createElement('div');
                rightDiv.className = 'code-line';
                if (rightLine !== null) {
                    const highlightedRight = highlightSyntax(rightLine || '\u00A0', language);
                    rightDiv.innerHTML = highlightedRight;
                    if (leftLine === null || leftLine !== rightLine) {
                        rightDiv.classList.add('added-line');
                    }
                } else {
                    rightDiv.innerHTML = '\u00A0';
                }
                rightContent.appendChild(rightDiv);
            }
            
            leftDisplay.appendChild(leftLineNumbers);
            leftDisplay.appendChild(leftContent);
            rightDisplay.appendChild(rightLineNumbers);
            rightDisplay.appendChild(rightContent);
            
            // Show displays, hide textareas
            document.getElementById('leftCode').style.display = 'none';
            document.getElementById('rightCode').style.display = 'none';
            leftDisplay.style.display = 'block';
            rightDisplay.style.display = 'block';
            
            // Change button text
            document.querySelector('.convert-btn').textContent = '다시 편집';
            document.querySelector('.convert-btn').onclick = function() {
                document.getElementById('leftCode').style.display = 'block';
                document.getElementById('rightCode').style.display = 'block';
                leftDisplay.style.display = 'none';
                rightDisplay.style.display = 'none';
                this.textContent = '변환';
                this.onclick = null;
            };
        });
        
        // Language detection function
        function detectLanguage(code) {
            if (code.includes('<!DOCTYPE') || code.includes('<html') || code.includes('<div')) {
                return 'html';
            } else if (code.includes('def ') || code.includes('import ') || code.includes('print(')) {
                return 'python';
            } else if (code.includes('function') || code.includes('const ') || code.includes('let ') || code.includes('var ')) {
                return 'javascript';
            } else if (code.includes('{') && code.includes('}') && code.includes(':') && code.includes(';')) {
                return 'css';
            }
            return 'markup'; // default to HTML
        }
        
        // Syntax highlighting function
        function highlightSyntax(code, language) {
            if (!code || code === '\u00A0') return '\u00A0';
            
            // HTML entities escape
            const escapeHtml = (text) => {
                const map = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                };
                return text.replace(/[&<>"']/g, m => map[m]);
            };
            
            let highlighted = escapeHtml(code);
            
            if (language === 'html' || language === 'markup') {
                // Comments
                highlighted = highlighted.replace(/(&lt;!--.*?--&gt;)/g,
                    '<span class="token comment">$1</span>');
                    
                // DOCTYPE
                highlighted = highlighted.replace(/(&lt;!DOCTYPE.*?&gt;)/gi,
                    '<span class="token doctype">$1</span>');
                
                // HTML tags with attributes
                highlighted = highlighted.replace(/(&lt;\/?)(\w+)((?:\s+[\w-]+(?:=(?:&quot;[^&]*&quot;|&#039;[^&]*&#039;))?)*\s*)(&gt;)/g, 
                    function(match, open, tagName, attrs, close) {
                        // Process attributes
                        let processedAttrs = attrs;
                        if (attrs) {
                            processedAttrs = attrs.replace(/([\w-]+)(=)(&quot;|&#039;)([^&]*)(\3)/g,
                                ' <span class="token attr-name">$1</span><span class="token punctuation">$2</span><span class="token string">$3$4$5</span>');
                        }
                        return `<span class="token tag"><span class="token punctuation">${open}</span><span class="token tag-name">${tagName}</span>${processedAttrs}<span class="token punctuation">${close}</span></span>`;
                    });
                    
            } else if (language === 'css' || code.includes('{') && code.includes(':') && code.includes(';')) {
                // CSS Comments
                highlighted = highlighted.replace(/(\/\*[\s\S]*?\*\/)/g,
                    '<span class="token comment">$1</span>');
                    
                // CSS Selectors (improved)
                highlighted = highlighted.replace(/([\.#]?[\w-\[\]:,\s]+)(\s*\{)/g,
                    '<span class="token selector">$1</span><span class="token punctuation">$2</span>');
                    
                // CSS Properties and values
                highlighted = highlighted.replace(/(\s*)([\w-]+)(\s*:\s*)([^;]+)(;)/g,
                    '$1<span class="token property">$2</span><span class="token punctuation">$3</span><span class="token value">$4</span><span class="token punctuation">$5</span>');
                    
                // Closing braces
                highlighted = highlighted.replace(/(\})/g,
                    '<span class="token punctuation">$1</span>');
                    
                // Colors in values
                highlighted = highlighted.replace(/#([0-9a-fA-F]{3,8})\b/g,
                    '<span class="token color">#$1</span>');
                    
            } else if (language === 'javascript') {
                // Single line comments
                highlighted = highlighted.replace(/(\/\/.*$)/gm,
                    '<span class="token comment">$1</span>');
                    
                // Multi-line comments
                highlighted = highlighted.replace(/(\/\*[\s\S]*?\*\/)/g,
                    '<span class="token comment">$1</span>');
                
                // Keywords (expanded list)
                const keywords = ['const', 'let', 'var', 'function', 'if', 'else', 'return', 'for', 'while', 'new', 'this', 'null', 'undefined', 'true', 'false', 'document', 'window', 'console'];
                keywords.forEach(keyword => {
                    const regex = new RegExp(`\\b(${keyword})\\b`, 'g');
                    highlighted = highlighted.replace(regex, '<span class="token keyword">$1</span>');
                });
                
                // Strings (double and single quotes)
                highlighted = highlighted.replace(/(&#039;[^&#039;]*&#039;|&quot;[^&quot;]*&quot;)/g,
                    '<span class="token string">$1</span>');
                    
                // Functions
                highlighted = highlighted.replace(/(\w+)(\s*\()/g,
                    '<span class="token function">$1</span>$2');
                    
                // Numbers
                highlighted = highlighted.replace(/\b(\d+)\b/g,
                    '<span class="token number">$1</span>');
            }
            
            return highlighted;
        }
    </script>
</body>
</html>